{% extends "main.html.twig" %}

{% block content %}
<div class="favorites-section recipes-section">
    <h1 class="search-results__title">Mijn favorieten</h1>

    {% if hasFavorites %}
        {% set resultLabel = favoritesCount == 1 ? 'favoriet recept' : 'favoriete recepten' %}
        <p class="search-results__intro">
            Je hebt {{ favoritesCount }} {{ resultLabel }} opgeslagen.
        </p>

        <div class="recipes-grid">
            {% for recipe in recipes %}
                {% set imageFile = recipe.image ?? '' %}
                {% set resolvedImage = imageFile %}
                {% if resolvedImage is empty %}
                    {% set resolvedImage = 'assets/img/logo-v2.png' %}
                {% elseif resolvedImage starts with 'http' %}
                {% elseif resolvedImage starts with 'assets/' %}
                {% else %}
                    {% set resolvedImage = 'assets/img/' ~ resolvedImage %}
                {% endif %}

                <article class="recipe-card">
                    <div class="recipe-card__image">
                        <img src="{{ resolvedImage }}" alt="{{ recipe.display_title|default('Recept') }}">
                    </div>
                    <div class="recipe-card__body">
                        <div class="recipe-card__header">
                            <h3 class="recipe-card__title">
                                {{ recipe.display_title|default('Recept zonder titel') }}
                            </h3>
                            {% set ratingValue = recipe.rating is defined and recipe.rating is not null ? (recipe.rating + 0) : null %}
                            {% set ratingPercent = ratingValue is not null ? ((ratingValue / 5) * 100) : 0 %}
                            <div class="recipe-card__rating" aria-label="{{ ratingValue ? 'Beoordeling ' ~ ratingValue ~ ' van 5' : 'Nog geen beoordeling' }}">
                                <div class="rating-stars" aria-hidden="true">
                                    <div class="rating-stars__base">
                                        {% for star in 1..5 %}
                                            <i class="fa fa-star recipe-card__star" aria-hidden="true"></i>
                                        {% endfor %}
                                    </div>
                                    <div
                                        class="rating-stars__fill"
                                        style="width: {{ ratingPercent ? ratingPercent|number_format(2, '.', '') : 0 }}%;"
                                    >
                                        {% for star in 1..5 %}
                                            <i class="fa fa-star recipe-card__star" aria-hidden="true"></i>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% set description = recipe.display_description|default('') %}
                        {% set servings = recipe.servings_total|default(4) %}
                        {% set caloriesPerServing = recipe.calories_per_serving is not null ? recipe.calories_per_serving : recipe.calories_total %}
                        <p class="recipe-card__description">
                            {% if description|length > 280 %}
                                {{ description|slice(0, 280) ~ '...' }}
                            {% else %}
                                {{ description }}
                            {% endif %}
                        </p>
                        <div class="recipe-card__footer">
                            <a class="recipe-card__cta" href="?action=detail&id={{ recipe.id|e }}">Smullen!</a>
                            <div class="recipe-card__meta">
                                <span class="recipe-card__meta-item" title="Aantal personen">
                                    <i class="fa fa-users" aria-hidden="true"></i>
                                    {{ servings }}
                                </span>
                                <span class="recipe-card__meta-item" title="Geschatte prijs">
                                    <i class="fa fa-eur" aria-hidden="true"></i>
                                    {% if recipe.price_total is not null %}
                                        &euro;{{ (recipe.price_total / 100 )|number_format(2, ',', '.') }}
                                    {% else %}
                                        n.t.b.
                                    {% endif %}
                                </span>
                                <span class="recipe-card__meta-item" title="Calorieen">
                                    <i class="fa fa-fire" aria-hidden="true"></i>
                                    {% if caloriesPerServing is not null %}
                                        {{ caloriesPerServing }} kcal
                                    {% else %}
                                        n.t.b.
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <p class="search-results__intro">
            Je hebt nog geen favoriete recepten. Klik op het hartje bij een recept om het toe te voegen.
        </p>
    {% endif %}
</div>
{% endblock %}
